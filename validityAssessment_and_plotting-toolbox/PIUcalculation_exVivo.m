%% Percentage Integral Uniformity - ex vivo phantom
% 
% The PIU can quantitatively assess the homogeneity of the corrected images
%
% This code calculates the PIU on the cortex and the basal ganglia/thalamus
% (left and right) as selected manually from the images
%
%
% If you use or modify this code, please cite:
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Ramos Delgado P, Kuehne A, Periquito J, et al. B1 Inhomogeneity 
% Correction of RARE MRI with Transceive SurFA_orderedce Radiofrequency Probes. 
% Magnetic Resonance in Medicine 2020; 00:1-20. 
% https://doi.org/10.1002/mrm.28307
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
% INPUT:
%%%% img_vol          : volume RF coil image
%%%% img_ori          : original cryoprobe or Tx/Rx surface RF coil image
%%%% sensCorrected    : B1-corrected (sensitivity) image
%%%% MBCorrected      : B1-corrected (model-based) image
%%%% hybCorrected     : B1-corrected (hybrid) image
%
% OUTPUT:
%%%% PIU_all = [PIU_vol,PIU_ori,PIU_MBcorr,PIU_sens,PIU_hyb];
%%%% excel sheet with PIU values
%
%
% IMPORTANT: a PIU of 100% represents perfect image homogeneity
%
% April 2020
% Paula Ramos Delgado
% ramosdelgado.paula@gmail.com
%


%% Load data

load('O:\Users\pramosdelgado\test_data\cryoprobe_data\exVivoData_cryo.mat','img_ori', 'img_vol','params_crp');
load('O:\Users\pramosdelgado\results_folder\B1correction\sensCorrection_exVivo.mat','sensCorrected');
load('O:\Users\pramosdelgado\results_folder\B1correction\modelBasedCorrection_exVivo.mat','MBCorrected');
load('O:\Users\pramosdelgado\results_folder\B1correction\hybridCorrection_exVivo.mat','hybCorrected');


%% User-defined parameters

pathOUT = 'O:\Users\pramosdelgado\output_folder';


% Select ROI positions %%%%%%%%%%%%%%%%%%

% Volume RF coil
figure(), imagesc(img_vol, [0 5e7]), shg, colormap(gray(256))

cortex_vol = impoly(gca, [59.3352103126734 35.3435889228596;56.8110475199445 35.9810661690129;55.0279512082322 36.9945141790742;52.7585559024165 37.4118163008641;50.6139571538008 38.105589342281;49.1518383628165 39.3194831433324;47.2471673025784 40.7502332751836;45.5045959070413 42.1213688182076;43.4783500982773 44.2078794271573;42.131642437637 45.4167669231024;41.5342963308649 46.8248455682976;40.9369502240928 48.5578654393071;40.5581414009877 51.1095959205748;40.5581414009877 52.8049414465624;41.3710544571627 54.6404324719056;42.0194531159672 55.8923388372754;43.2757255174009 57.6807765020893;44.4914730026593 59.1115266339405;45.3830211585155 61.138422654063;45.9098450687941 62.9864749077042;47.044542721702 64.8941417501724;48.1792403746098 66.3845064708508;49.4355127760435 66.4441210596779;51.4188588920827 65.9174972314507;53.0745802851175 64.7834994462902;54.4755753099931 63.9330011074197;55.6218439667096 63.6495016611296;56.03336481895 62.6944570148232;55.6218439667096 61.5232558139535;54.1769279685513 61.2576518317173;53.1638050641693 59.9461308775204;52.0696323274367 59.4095995780762;51.2591340039311 58.5749953344963;50.4891605966008 57.9192348573979;49.7597121054457 56.5480993143738;48.4895056582518 55.4280177187154;47.0040178055267 55.0577345936955;45.1780628721822 54.577519379845;44.6686101358638 54.1522702104097;44.4138837677046 52.593023255814;44.4138837677046 51.1755260243632;44.4138837677046 49.6162790697674;45.0031523827428 48.1144854913301;45.2500974372848 46.5321630004084;45.7679533754584 45.5104818563445;46.1937283730601 44.5709778773597;47.3013445211752 43.2189398203846;48.8520071285364 41.6165243454512;50.5688121581149 40.8653920915761;52.3104011806399 39.9772978959026;54.0934857577543 39.5520487264673;56.2586598871076 38.985049833887;57.404928543824 38.4180509413068;59.1880131209384 37.4258028792913;60.4616449617344 37.5675526024363;61.7500473476696 38.7860821992399;62.5348823195193 40.0199169987086;63.6386827058736 40.6150146736178;64.912441276206 40.8653920915761;66.3203514293961 40.4025470653378;67.0722927650306 39.5634295181927;67.9760728224309 38.5598006644518;68.7402519269086 38.2763012181617;70.2686101358638 37.8510520487265;71.4148787925802 37.8510520487265;73.3253265537742 37.9928017718715;75.3631374990479 38.4180509413068;76.2546797876051 38.843300110742;77.6556748124807 39.2685492801772;79.6934857577543 40.4025470653378;81.9860230711872 41.8200442967885;83.3870180960628 43.2375415282392;84.915376305018 44.5132890365448;85.5804910383774 46.0657075161054;85.9372342074 47.4846175354945;85.8069185935752 48.6240310077519;85.2925784015247 50.4798849411768;84.4064854830326 52.6832062192102;83.9394724608736 53.5920997928647;82.0844079819562 54.5174758924662;80.3720407706479 55.6279272119881;79.5158571649937 56.6766867915365;78.3742790241215 58.0339050709521;77.4009484443215 59.1135105204873;75.7452270512867 60.3892580287929;74.2168688423314 61.3815060908084;74.4715952104906 62.515503875969;76.6367693398439 63.3660022148394;77.7830379965603 64.5;78.4198539169583 65.4922480620155;80.0755753099931 66.3427464008859;81.3492071507892 66.7679955703211;83.1322917279036 65.7757475083056;84.27856038462 64.2165005537098;84.4320460912747 62.5814339797574;85.2974658572568 61.8067552602436;85.6667713639844 59.9819041732431;85.9342817776548 59.1135105204873;86.5710976980529 57.8377630121816;87.0805504343712 56.4202657807309;88.2268190910877 55.1445182724252;89.0765740947986 54.2707089325725;89.4532622002944 53.087499034227;89.6178922366557 50.4879692277127;89.0830464299237 47.8538261167095;88.6649041551832 46.8248455682976;87.9747080587351 45.8174733254899;87.1642097352295 44.4463377824658;86.1510868308475 43.5521189500588;84.9353393455891 42.300212584689;83.3953925309284 40.8694624528379;81.7743958839172 39.5579414986409;79.0187015839982 38.1868059556169;76.4251069487802 37.2925871232099;73.1425887385825 36.1599099354944;70.9542432651174 35.6233786360502;68.9524826317041 35.4519026647977;67.9967288608687 35.831000761581;66.921505868679 36.4267263422405;65.1740827726797 36.7170542635659;63.4417164552086 36.6991589496805;62.4539362370408 35.7949746691538;61.3064524650213 35.3977457938286]); 
BGTLeft_vol = impoly(gca,[60.6574803149606 46.5884955752212;59.5236220472441 45.7389380530973;57.003937007874 45.1725663716814;54.8622047244094 45.4557522123894;52.8464566929134 46.1637168141593;51.9645669291339 47.0132743362832;51.4606299212598 47.8628318584071;50.3267716535433 49.5619469026549;50.3267716535433 51.5442477876106;51.1226202321725 52.7833571863936;52.0087131506646 54.4859236285103;53.3378525284028 55.2370558823854;54.7362204724409 56.5;55.8700787401575 57.2079646017699;56.8822242023712 58.2415848978856;58.0452211578921 59.393321020494;58.8937007874016 60.6061946902655;60.2795275590551 61.4557522123894;61.5393700787401 61.8805309734513;63.0511811023622 60.6061946902655;63.3031496062992 57.9159292035398;63.3031496062992 56.0752212389381;63.3031496062992 54.2345132743363;63.3031496062992 52.2522123893805;63.0511811023622 50.5530973451327;62.1692913385827 48.570796460177;61.6653543307087 47.4380530973451]); 
BGTRight_vol = impoly(gca,[72.5236910521513 45.2020231564773;70.6686265732339 45.2020231564773;69.4556997985572 45.8806322961851;68.742213460512 46.7443166558132;67.8146812210533 47.7930762353616;66.9584976153992 49.0269110348304;66.6731030801811 50.4458210542194;66.102314009745 52.1114980335022;66.102314009745 53.9622502327053;66.1736626435495 56.4916115716162;66.8158003477901 58.0339050709521;66.8871489815946 59.7612737902084;67.0298462492037 61.0568003296505;67.8146812210533 61.8587929493052;69.1703052633391 62.4140186090661;70.2405347704068 62.3523268690927;71.3107642774745 61.3652590295177;71.9673661694994 60.2442038216561;72.6157648283039 59.1711412227677;73.4262631518095 58.1576932127064;74.1962365591398 56.9654014361637;75.1283096311712 55.7731096596211;75.7767082899757 54.7596616495598;76.9519308590589 54.401974116597;78.1676783443173 54.1039011724614;78.9450680945576 53.5304080528913;79.8726003340163 52.0498062935288;79.8012517002118 50.2607458342991;79.5872057987982 48.6567605949898;78.5169762917305 47.6696927554148;76.3051686437906 46.6826249158398;75.3776364043319 46.1273992560789;73.736617826828 45.6338653362914]);

cortex_vol = cortex_vol.createMask;
BGTLeft_vol = BGTLeft_vol.createMask;
BGTRight_vol  = BGTRight_vol.createMask;

close;

% CRP original
figure(), imagesc(img_ori, [0 1.5e8]), shg, colormap(gray(256))

cortex_ori = impoly(gca, [59.6519175414661 35.7612345679012;57.2521345376079 36.3206419753086;55.3977567618994 36.9266666666667;53.270676372116 37.6259259259259;50.8708933682578 38.837975308642;49.343758729439 39.9101728395062;47.7075430449903 41.2620740740741;46.2349489289864 42.3342716049383;44.3805711532778 44.198962962963;43.2865814379862 45.5123786002117;42.6898149460141 46.6230617283951;42.1444097178645 48.2546666666667;41.9262476266047 50.7253827160494;42.0898691950496 52.5434567901235;42.1989502406795 54.1284444444444;43.0170580829039 55.5735802469136;44.2169495848329 57.0187160493827;45.2532195183171 59.0698765432099;46.0167868377265 60.7947160493827;46.5076515430612 62.706024691358;47.2166783396556 64.3842469135803;48.5533174768346 65.5342017789827;49.8841742936208 65.5153141623133;51.4752737723601 65.0060481699504;52.6296268767653 64.3818666320031;53.7118329121451 63.5176152717684;55.0465536891135 62.9894616627361;55.5876567068034 62.3652801247888;54.8301124820376 61.4050008356391;53.8922005847084 61.1169170488942;53.0264357564045 60.3006796531169;52.0524503245627 59.4364282928822;51.4752737723601 58.4761490037325;50.82059549403 57.1789234675823;49.8158911847778 56.3635345676032;48.6554213646768 55.4779267898414;47.0021554927903 55.4032552784535;45.3439785786072 54.627428450971;44.5491551459293 53.4346827356967;44.477008076904 51.9942638019721;44.4351116760928 50.7253827160494;44.585228680442 48.6813002544057;44.9820375600813 47.3369092495961;45.6875037901936 46.4125469549637;46.2260891266928 45.5224905538202;47.101290298504 44.4205159619283;47.7071988020656 43.6576104752339;48.8516926421264 42.0470322255457;50.5347718186865 40.6907558047557;52.2178509952465 39.7159321273128;54.1702228400562 38.7834920880196;55.7859788495538 38.190121153924;57.6037043602387 37.9358193250259;59.3539288273634 37.4757119504173;61.3426737487298 37.252987654321;62.9788894331785 37.7657777777778;63.7969972754029 38.4184197530864;64.6060403349685 39.5106330430261;65.4357316287597 39.7507028653136;66.2654229225509 39.8467307942285;67.1785096899303 39.5838518518518;67.960879044646 39.0304933984513;68.7056443287491 38.0920987654321;70.4345258422887 37.9009611198525;71.5807944990051 37.9009611198525;73.4912422601992 38.0427108429975;75.5290532054728 38.4679600124328;76.42059549403 38.893209181868;77.9229926844771 38.9312098765432;80.3589348273304 40.3940703377078;81.9073676697657 41.7079631203482;83.7250931804505 42.9370886266892;85.0715565216986 44.5052832382277;86.148727194697 45.7344087445687;86.7040168576853 47.4621728395062;86.6494763348704 49.0005432098765;86.2131521523507 50.9584691358025;85.885909015461 52.9163950617284;84.9041796047917 54.4081481481482;83.7042881028626 55.760049382716;82.4498560781186 56.9254814814815;81.7953698043391 58.0442962962963;80.650018825225 59.2097283950617;79.7773704601856 60.3285432098766;78.1411547757369 61.493975308642;77.2685064106976 61.8669135802469;76.6140201369181 62.4263209876543;76.9958037966228 63.0323456790124;78.5229384354416 63.8248395061729;79.341046277666 64.7105679012346;80.5409377795951 64.9436543209877;81.7953698043391 65.7361481481482;83.2982074343286 65.8256565794316;84.4444760910449 64.2664096248358;84.5979617976996 62.6313430508834;85.4633815636817 61.8566643313696;85.8326870704093 60.0318132443691;86.1001974840798 59.1634195916133;86.7370134044778 57.8876720833076;87.2464661407962 56.4701748518569;88.0675299280593 55.154024691358;88.6674756790238 53.8021234567901;88.6674756790239 51.8441975308642;88.6129351562089 50.3990617283951;88.7070075430683 48.1926597572507;88.5723612089434 46.8787669746103;88.1766109736892 45.2711604938272;87.3738293248758 43.9961992150906;86.3817008238425 42.9213030586832;84.6002943522618 41.7503467584979;83.3211541780761 40.648372166606;81.7053981685785 39.5887812128638;78.2502358213668 37.859012345679;75.6894617708972 36.6172078132296;73.6939412881527 36.1133228845892;71.1356609397814 35.731870141242;69.5199049302838 35.9437883319905;67.9420770093397 36.6003456790123;66.3604018477059 36.8334320987654;65.2695913914068 36.4604938271605;64.2333214579226 35.9010864197531;62.9243489103636 35.5747654320988;61.5062953171747 35.7146172839506]); 
BGTLeft_ori = impoly(gca,[60.6574803149606 46.5884955752212;59.5236220472441 45.7389380530973;57.003937007874 45.1725663716814;54.8622047244094 45.4557522123894;52.8464566929134 46.1637168141593;51.9645669291339 47.0132743362832;51.4606299212598 47.8628318584071;50.8259501511323 49.5455516146404;50.8259501511323 51.4661101929398;51.6917149794361 52.6664593043769;52.7017739457906 53.8187944513565;53.8200535156831 54.5870178826763;55.1547742926515 55.8833949230284;56.164833259006 57.035730070008;56.8822242023712 58.2415848978856;58.0452211578921 59.393321020494;58.8937007874016 60.6061946902655;60.1461902392136 61.0530954891224;61.6339636918924 61.3215488215488;62.8745106783608 60.3486936175744;63.3031496062992 57.9159292035398;63.3031496062992 56.0752212389381;63.3031496062992 54.2345132743363;63.0548783509241 52.1863196598021;62.8384371438482 50.6498727971625;62.1692913385827 48.570796460177;61.6653543307087 47.4380530973451]);
BGTRight_ori = impoly(gca,[72.5236910521513 45.2020231564773;70.8828353401715 45.4643646357542;69.6924087012537 46.232588067074;69.1513056835637 46.9527975339362;68.3216143897725 48.0091047520009;67.4558495614687 49.305481792353;67.1311877508548 50.6018588327051;66.8425994747535 52.2343336242595;66.6983053367028 53.9148223802715;66.6622318021902 56.0274368164008;67.0229671473168 58.0920372880727;67.419776026956 59.1483445061373;67.9248055101333 60.3006796531169;68.6823497348992 61.0208891199792;69.5462134175023 61.3886621546554;70.5606044079651 61.455775487762;71.3107642774745 61.3652590295177;72.0732619790892 60.4927355109469;72.8090855873694 59.6378903102615;73.736617826828 58.5274389907396;74.5214527986777 57.6020628911381;75.3559536197413 56.4595624965182;76.1856449135325 55.451269242911;76.8710420692731 54.4429759893038;78.0175358550989 54.3324006725459;78.9450680945576 53.5304080528913;79.8726003340163 52.0498062935288;79.8012517002118 50.2607458342991;79.215821812596 48.7773281833206;78.2779099152668 47.817048894171;76.6185273276845 46.5206718538189;75.4281006887667 45.9925182447865;74.0933799117982 45.5603925646692]);

cortex_ori = cortex_ori.createMask;
BGTLeft_ori = BGTLeft_ori.createMask;
BGTRight_ori = BGTRight_ori.createMask;

close;

% Model-based correction
figure(), imagesc(MBCorrected, [0 3e8]), shg, colormap(gray(256))

cortex_MBcorr = impoly(gca, [59.6519175414661 35.7612345679012;57.2521345376079 36.3206419753086;55.3977567618994 36.9266666666667;53.270676372116 37.6259259259259;50.8708933682578 38.837975308642;49.343758729439 39.9101728395062;47.7075430449903 41.2620740740741;46.2349489289864 42.3342716049383;44.3805711532778 44.198962962963;43.2865814379862 45.5123786002117;42.6898149460141 46.6230617283951;42.1444097178645 48.2546666666667;41.9262476266047 50.7253827160494;42.0898691950496 52.5434567901235;42.1989502406795 54.1284444444444;43.0170580829039 55.5735802469136;44.2169495848329 57.0187160493827;45.2532195183171 59.0698765432099;46.0167868377265 60.7947160493827;46.5076515430612 62.706024691358;47.2166783396556 64.3842469135803;48.5533174768346 65.5342017789827;49.8841742936208 65.5153141623133;51.4752737723601 65.0060481699504;52.6296268767653 64.3818666320031;53.7118329121451 63.5176152717684;55.0465536891135 62.9894616627361;55.5876567068034 62.3652801247888;54.8301124820376 61.4050008356391;53.8922005847084 61.1169170488942;53.0264357564045 60.3006796531169;52.0524503245627 59.4364282928822;51.4752737723601 58.4761490037325;50.82059549403 57.1789234675823;49.8158911847778 56.3635345676032;48.6554213646768 55.4779267898414;47.0021554927903 55.4032552784535;45.3439785786072 54.627428450971;44.5491551459293 53.4346827356967;44.477008076904 51.9942638019721;44.4351116760928 50.7253827160494;44.585228680442 48.6813002544057;44.9820375600813 47.3369092495961;45.6875037901936 46.4125469549637;46.2260891266928 45.5224905538202;47.101290298504 44.4205159619283;47.7071988020656 43.6576104752339;48.8516926421264 42.0470322255457;50.5347718186865 40.6907558047557;52.2178509952465 39.7159321273128;54.1702228400562 38.7834920880196;55.7859788495538 38.190121153924;57.6037043602387 37.9358193250259;59.3539288273634 37.4757119504173;61.3426737487298 37.252987654321;62.9788894331785 37.7657777777778;63.7969972754029 38.4184197530864;64.6060403349685 39.5106330430261;65.4357316287597 39.7507028653136;66.2654229225509 39.8467307942285;67.1785096899303 39.5838518518518;67.960879044646 39.0304933984513;68.7056443287491 38.0920987654321;70.4345258422887 37.9009611198525;71.5807944990051 37.9009611198525;73.4912422601992 38.0427108429975;75.5290532054728 38.4679600124328;76.42059549403 38.893209181868;77.9229926844771 38.9312098765432;80.3589348273304 40.3940703377078;81.9073676697657 41.7079631203482;83.7250931804505 42.9370886266892;85.0715565216986 44.5052832382277;86.148727194697 45.7344087445687;86.7040168576853 47.4621728395062;86.6494763348704 49.0005432098765;86.2131521523507 50.9584691358025;85.885909015461 52.9163950617284;84.9041796047917 54.4081481481482;83.7042881028626 55.760049382716;82.4498560781186 56.9254814814815;81.7953698043391 58.0442962962963;80.650018825225 59.2097283950617;79.7773704601856 60.3285432098766;78.1411547757369 61.493975308642;77.2685064106976 61.8669135802469;76.6140201369181 62.4263209876543;76.9958037966228 63.0323456790124;78.5229384354416 63.8248395061729;79.341046277666 64.7105679012346;80.5409377795951 64.9436543209877;81.7953698043391 65.7361481481482;83.2982074343286 65.8256565794316;84.4444760910449 64.2664096248358;84.5979617976996 62.6313430508834;85.4633815636817 61.8566643313696;85.8326870704093 60.0318132443691;86.1001974840798 59.1634195916133;86.7370134044778 57.8876720833076;87.2464661407962 56.4701748518569;88.0675299280593 55.154024691358;88.6674756790238 53.8021234567901;88.6674756790239 51.8441975308642;88.6129351562089 50.3990617283951;88.7070075430683 48.1926597572507;88.5723612089434 46.8787669746103;88.1766109736892 45.2711604938272;87.3738293248758 43.9961992150906;86.3817008238425 42.9213030586832;84.6002943522618 41.7503467584979;83.3211541780761 40.648372166606;81.7053981685785 39.5887812128638;78.2502358213668 37.859012345679;75.6894617708972 36.6172078132296;73.6939412881527 36.1133228845892;71.1356609397814 35.731870141242;69.5199049302838 35.9437883319905;67.9420770093397 36.6003456790123;66.3604018477059 36.8334320987654;65.2695913914068 36.4604938271605;64.2333214579226 35.9010864197531;62.9243489103636 35.5747654320988;61.5062953171747 35.7146172839506]); 
BGTLeft_MBcorr = impoly(gca,[60.6574803149606 46.5884955752212;59.5236220472441 45.7389380530973;57.003937007874 45.1725663716814;54.8622047244094 45.4557522123894;52.8464566929134 46.1637168141593;51.9645669291339 47.0132743362832;51.4606299212598 47.8628318584071;50.8259501511323 49.5455516146404;50.8259501511323 51.4661101929398;51.6917149794361 52.6664593043769;52.7017739457906 53.8187944513565;53.8200535156831 54.5870178826763;55.1547742926515 55.8833949230284;56.164833259006 57.035730070008;56.8822242023712 58.2415848978856;58.0452211578921 59.393321020494;58.8937007874016 60.6061946902655;60.1461902392136 61.0530954891224;61.6339636918924 61.3215488215488;62.8745106783608 60.3486936175744;63.3031496062992 57.9159292035398;63.3031496062992 56.0752212389381;63.3031496062992 54.2345132743363;63.0548783509241 52.1863196598021;62.8384371438482 50.6498727971625;62.1692913385827 48.570796460177;61.6653543307087 47.4380530973451]);
BGTRight_MBcorr = impoly(gca,[72.5236910521513 45.2020231564773;70.8828353401715 45.4643646357542;69.6924087012537 46.232588067074;69.1513056835637 46.9527975339362;68.3216143897725 48.0091047520009;67.4558495614687 49.305481792353;67.1311877508548 50.6018588327051;66.8425994747535 52.2343336242595;66.6983053367028 53.9148223802715;66.6622318021902 56.0274368164008;67.0229671473168 58.0920372880727;67.419776026956 59.1483445061373;67.9248055101333 60.3006796531169;68.6823497348992 61.0208891199792;69.5462134175023 61.3886621546554;70.5606044079651 61.455775487762;71.3107642774745 61.3652590295177;72.0732619790892 60.4927355109469;72.8090855873694 59.6378903102615;73.736617826828 58.5274389907396;74.5214527986777 57.6020628911381;75.3559536197413 56.4595624965182;76.1856449135325 55.451269242911;76.8710420692731 54.4429759893038;78.0175358550989 54.3324006725459;78.9450680945576 53.5304080528913;79.8726003340163 52.0498062935288;79.8012517002118 50.2607458342991;79.215821812596 48.7773281833206;78.2779099152668 47.817048894171;76.6185273276845 46.5206718538189;75.4281006887667 45.9925182447865;74.0933799117982 45.5603925646692]);

cortex_MBcorr = cortex_MBcorr.createMask;
BGTLeft_MBcorr = BGTLeft_MBcorr.createMask;
BGTRight_MBcorr = BGTRight_MBcorr.createMask;

close;

% Sensitivity correction
figure(), imagesc(sensCorrected, [0 3e8]), shg, colormap(gray(256))

cortex_sens = impoly(gca, [59.6519175414661 35.7612345679012;57.2521345376079 36.3206419753086;55.3977567618994 36.9266666666667;53.270676372116 37.6259259259259;50.8708933682578 38.837975308642;49.343758729439 39.9101728395062;47.7075430449903 41.2620740740741;46.2349489289864 42.3342716049383;44.3805711532778 44.198962962963;43.2865814379862 45.5123786002117;42.6898149460141 46.6230617283951;42.1444097178645 48.2546666666667;41.9262476266047 50.7253827160494;42.0898691950496 52.5434567901235;42.1989502406795 54.1284444444444;43.0170580829039 55.5735802469136;44.2169495848329 57.0187160493827;45.2532195183171 59.0698765432099;46.0167868377265 60.7947160493827;46.5076515430612 62.706024691358;47.2166783396556 64.3842469135803;48.5533174768346 65.5342017789827;49.8841742936208 65.5153141623133;51.4752737723601 65.0060481699504;52.6296268767653 64.3818666320031;53.7118329121451 63.5176152717684;55.0465536891135 62.9894616627361;55.5876567068034 62.3652801247888;54.8301124820376 61.4050008356391;53.8922005847084 61.1169170488942;53.0264357564045 60.3006796531169;52.0524503245627 59.4364282928822;51.4752737723601 58.4761490037325;50.82059549403 57.1789234675823;49.8158911847778 56.3635345676032;48.6554213646768 55.4779267898414;47.0021554927903 55.4032552784535;45.3439785786072 54.627428450971;44.5491551459293 53.4346827356967;44.477008076904 51.9942638019721;44.4351116760928 50.7253827160494;44.585228680442 48.6813002544057;44.9820375600813 47.3369092495961;45.6875037901936 46.4125469549637;46.2260891266928 45.5224905538202;47.101290298504 44.4205159619283;47.7071988020656 43.6576104752339;48.8516926421264 42.0470322255457;50.5347718186865 40.6907558047557;52.2178509952465 39.7159321273128;54.1702228400562 38.7834920880196;55.7859788495538 38.190121153924;57.6037043602387 37.9358193250259;59.3539288273634 37.4757119504173;61.3426737487298 37.252987654321;62.9788894331785 37.7657777777778;63.7969972754029 38.4184197530864;64.6060403349685 39.5106330430261;65.4357316287597 39.7507028653136;66.2654229225509 39.8467307942285;67.1785096899303 39.5838518518518;67.960879044646 39.0304933984513;68.7056443287491 38.0920987654321;70.4345258422887 37.9009611198525;71.5807944990051 37.9009611198525;73.4912422601992 38.0427108429975;75.5290532054728 38.4679600124328;76.42059549403 38.893209181868;77.9229926844771 38.9312098765432;80.3589348273304 40.3940703377078;81.9073676697657 41.7079631203482;83.7250931804505 42.9370886266892;85.0715565216986 44.5052832382277;86.148727194697 45.7344087445687;86.7040168576853 47.4621728395062;86.6494763348704 49.0005432098765;86.2131521523507 50.9584691358025;85.885909015461 52.9163950617284;84.9041796047917 54.4081481481482;83.7042881028626 55.760049382716;82.4498560781186 56.9254814814815;81.7953698043391 58.0442962962963;80.650018825225 59.2097283950617;79.7773704601856 60.3285432098766;78.1411547757369 61.493975308642;77.2685064106976 61.8669135802469;76.6140201369181 62.4263209876543;76.9958037966228 63.0323456790124;78.5229384354416 63.8248395061729;79.341046277666 64.7105679012346;80.5409377795951 64.9436543209877;81.7953698043391 65.7361481481482;83.2982074343286 65.8256565794316;84.4444760910449 64.2664096248358;84.5979617976996 62.6313430508834;85.4633815636817 61.8566643313696;85.8326870704093 60.0318132443691;86.1001974840798 59.1634195916133;86.7370134044778 57.8876720833076;87.2464661407962 56.4701748518569;88.0675299280593 55.154024691358;88.6674756790238 53.8021234567901;88.6674756790239 51.8441975308642;88.6129351562089 50.3990617283951;88.7070075430683 48.1926597572507;88.5723612089434 46.8787669746103;88.1766109736892 45.2711604938272;87.3738293248758 43.9961992150906;86.3817008238425 42.9213030586832;84.6002943522618 41.7503467584979;83.3211541780761 40.648372166606;81.7053981685785 39.5887812128638;78.2502358213668 37.859012345679;75.6894617708972 36.6172078132296;73.6939412881527 36.1133228845892;71.1356609397814 35.731870141242;69.5199049302838 35.9437883319905;67.9420770093397 36.6003456790123;66.3604018477059 36.8334320987654;65.2695913914068 36.4604938271605;64.2333214579226 35.9010864197531;62.9243489103636 35.5747654320988;61.5062953171747 35.7146172839506]); 
BGTLeft_sens = impoly(gca,[60.6574803149606 46.5884955752212;59.5236220472441 45.7389380530973;57.003937007874 45.1725663716814;54.8622047244094 45.4557522123894;52.8464566929134 46.1637168141593;51.9645669291339 47.0132743362832;51.4606299212598 47.8628318584071;50.8259501511323 49.5455516146404;50.8259501511323 51.4661101929398;51.6917149794361 52.6664593043769;52.7017739457906 53.8187944513565;53.8200535156831 54.5870178826763;55.1547742926515 55.8833949230284;56.164833259006 57.035730070008;56.8822242023712 58.2415848978856;58.0452211578921 59.393321020494;58.8937007874016 60.6061946902655;60.1461902392136 61.0530954891224;61.6339636918924 61.3215488215488;62.8745106783608 60.3486936175744;63.3031496062992 57.9159292035398;63.3031496062992 56.0752212389381;63.3031496062992 54.2345132743363;63.0548783509241 52.1863196598021;62.8384371438482 50.6498727971625;62.1692913385827 48.570796460177;61.6653543307087 47.4380530973451]);
BGTRight_sens = impoly(gca,[72.5236910521513 45.2020231564773;70.8828353401715 45.4643646357542;69.6924087012537 46.232588067074;69.1513056835637 46.9527975339362;68.3216143897725 48.0091047520009;67.4558495614687 49.305481792353;67.1311877508548 50.6018588327051;66.8425994747535 52.2343336242595;66.6983053367028 53.9148223802715;66.6622318021902 56.0274368164008;67.0229671473168 58.0920372880727;67.419776026956 59.1483445061373;67.9248055101333 60.3006796531169;68.6823497348992 61.0208891199792;69.5462134175023 61.3886621546554;70.5606044079651 61.455775487762;71.3107642774745 61.3652590295177;72.0732619790892 60.4927355109469;72.8090855873694 59.6378903102615;73.736617826828 58.5274389907396;74.5214527986777 57.6020628911381;75.3559536197413 56.4595624965182;76.1856449135325 55.451269242911;76.8710420692731 54.4429759893038;78.0175358550989 54.3324006725459;78.9450680945576 53.5304080528913;79.8726003340163 52.0498062935288;79.8012517002118 50.2607458342991;79.215821812596 48.7773281833206;78.2779099152668 47.817048894171;76.6185273276845 46.5206718538189;75.4281006887667 45.9925182447865;74.0933799117982 45.5603925646692]);

cortex_sens = cortex_sens.createMask;
BGTLeft_sens = BGTLeft_sens.createMask;
BGTRight_sens = BGTRight_sens.createMask;

close;

% Hybrid correction
figure(), imagesc(hybCorrected, [0 3e8]), shg, colormap(gray(256))

cortex_hyb = impoly(gca, [59.6519175414661 35.7612345679012;57.2521345376079 36.3206419753086;55.3977567618994 36.9266666666667;53.270676372116 37.6259259259259;50.8708933682578 38.837975308642;49.343758729439 39.9101728395062;47.7075430449903 41.2620740740741;46.2349489289864 42.3342716049383;44.3805711532778 44.198962962963;43.2865814379862 45.5123786002117;42.6898149460141 46.6230617283951;42.1444097178645 48.2546666666667;41.9262476266047 50.7253827160494;42.0898691950496 52.5434567901235;42.1989502406795 54.1284444444444;43.0170580829039 55.5735802469136;44.2169495848329 57.0187160493827;45.2532195183171 59.0698765432099;46.0167868377265 60.7947160493827;46.5076515430612 62.706024691358;47.2166783396556 64.3842469135803;48.5533174768346 65.5342017789827;49.8841742936208 65.5153141623133;51.4752737723601 65.0060481699504;52.6296268767653 64.3818666320031;53.7118329121451 63.5176152717684;55.0465536891135 62.9894616627361;55.5876567068034 62.3652801247888;54.8301124820376 61.4050008356391;53.8922005847084 61.1169170488942;53.0264357564045 60.3006796531169;52.0524503245627 59.4364282928822;51.4752737723601 58.4761490037325;50.82059549403 57.1789234675823;49.8158911847778 56.3635345676032;48.6554213646768 55.4779267898414;47.0021554927903 55.4032552784535;45.3439785786072 54.627428450971;44.5491551459293 53.4346827356967;44.477008076904 51.9942638019721;44.4351116760928 50.7253827160494;44.585228680442 48.6813002544057;44.9820375600813 47.3369092495961;45.6875037901936 46.4125469549637;46.2260891266928 45.5224905538202;47.101290298504 44.4205159619283;47.7071988020656 43.6576104752339;48.8516926421264 42.0470322255457;50.5347718186865 40.6907558047557;52.2178509952465 39.7159321273128;54.1702228400562 38.7834920880196;55.7859788495538 38.190121153924;57.6037043602387 37.9358193250259;59.3539288273634 37.4757119504173;61.3426737487298 37.252987654321;62.9788894331785 37.7657777777778;63.7969972754029 38.4184197530864;64.6060403349685 39.5106330430261;65.4357316287597 39.7507028653136;66.2654229225509 39.8467307942285;67.1785096899303 39.5838518518518;67.960879044646 39.0304933984513;68.7056443287491 38.0920987654321;70.4345258422887 37.9009611198525;71.5807944990051 37.9009611198525;73.4912422601992 38.0427108429975;75.5290532054728 38.4679600124328;76.42059549403 38.893209181868;77.9229926844771 38.9312098765432;80.3589348273304 40.3940703377078;81.9073676697657 41.7079631203482;83.7250931804505 42.9370886266892;85.0715565216986 44.5052832382277;86.148727194697 45.7344087445687;86.7040168576853 47.4621728395062;86.6494763348704 49.0005432098765;86.2131521523507 50.9584691358025;85.885909015461 52.9163950617284;84.9041796047917 54.4081481481482;83.7042881028626 55.760049382716;82.4498560781186 56.9254814814815;81.7953698043391 58.0442962962963;80.650018825225 59.2097283950617;79.7773704601856 60.3285432098766;78.1411547757369 61.493975308642;77.2685064106976 61.8669135802469;76.6140201369181 62.4263209876543;76.9958037966228 63.0323456790124;78.5229384354416 63.8248395061729;79.341046277666 64.7105679012346;80.5409377795951 64.9436543209877;81.7953698043391 65.7361481481482;83.2982074343286 65.8256565794316;84.4444760910449 64.2664096248358;84.5979617976996 62.6313430508834;85.4633815636817 61.8566643313696;85.8326870704093 60.0318132443691;86.1001974840798 59.1634195916133;86.7370134044778 57.8876720833076;87.2464661407962 56.4701748518569;88.0675299280593 55.154024691358;88.6674756790238 53.8021234567901;88.6674756790239 51.8441975308642;88.6129351562089 50.3990617283951;88.7070075430683 48.1926597572507;88.5723612089434 46.8787669746103;88.1766109736892 45.2711604938272;87.3738293248758 43.9961992150906;86.3817008238425 42.9213030586832;84.6002943522618 41.7503467584979;83.3211541780761 40.648372166606;81.7053981685785 39.5887812128638;78.2502358213668 37.859012345679;75.6894617708972 36.6172078132296;73.6939412881527 36.1133228845892;71.1356609397814 35.731870141242;69.5199049302838 35.9437883319905;67.9420770093397 36.6003456790123;66.3604018477059 36.8334320987654;65.2695913914068 36.4604938271605;64.2333214579226 35.9010864197531;62.9243489103636 35.5747654320988;61.5062953171747 35.7146172839506]); 
BGTLeft_hyb = impoly(gca,[60.6574803149606 46.5884955752212;59.5236220472441 45.7389380530973;57.003937007874 45.1725663716814;54.8622047244094 45.4557522123894;52.8464566929134 46.1637168141593;51.9645669291339 47.0132743362832;51.4606299212598 47.8628318584071;50.8259501511323 49.5455516146404;50.8259501511323 51.4661101929398;51.6917149794361 52.6664593043769;52.7017739457906 53.8187944513565;53.8200535156831 54.5870178826763;55.1547742926515 55.8833949230284;56.164833259006 57.035730070008;56.8822242023712 58.2415848978856;58.0452211578921 59.393321020494;58.8937007874016 60.6061946902655;60.1461902392136 61.0530954891224;61.6339636918924 61.3215488215488;62.8745106783608 60.3486936175744;63.3031496062992 57.9159292035398;63.3031496062992 56.0752212389381;63.3031496062992 54.2345132743363;63.0548783509241 52.1863196598021;62.8384371438482 50.6498727971625;62.1692913385827 48.570796460177;61.6653543307087 47.4380530973451]);
BGTRight_hyb = impoly(gca,[72.5236910521513 45.2020231564773;70.8828353401715 45.4643646357542;69.6924087012537 46.232588067074;69.1513056835637 46.9527975339362;68.3216143897725 48.0091047520009;67.4558495614687 49.305481792353;67.1311877508548 50.6018588327051;66.8425994747535 52.2343336242595;66.6983053367028 53.9148223802715;66.6622318021902 56.0274368164008;67.0229671473168 58.0920372880727;67.419776026956 59.1483445061373;67.9248055101333 60.3006796531169;68.6823497348992 61.0208891199792;69.5462134175023 61.3886621546554;70.5606044079651 61.455775487762;71.3107642774745 61.3652590295177;72.0732619790892 60.4927355109469;72.8090855873694 59.6378903102615;73.736617826828 58.5274389907396;74.5214527986777 57.6020628911381;75.3559536197413 56.4595624965182;76.1856449135325 55.451269242911;76.8710420692731 54.4429759893038;78.0175358550989 54.3324006725459;78.9450680945576 53.5304080528913;79.8726003340163 52.0498062935288;79.8012517002118 50.2607458342991;79.215821812596 48.7773281833206;78.2779099152668 47.817048894171;76.6185273276845 46.5206718538189;75.4281006887667 45.9925182447865;74.0933799117982 45.5603925646692]);

cortex_hyb = cortex_hyb.createMask;
BGTLeft_hyb = BGTLeft_hyb.createMask;
BGTRight_hyb = BGTRight_hyb.createMask;

close;


%% Define ROIs in images

c1_MBcorr = MBCorrected .* cortex_MBcorr;
c2_MBcorr = MBCorrected .* BGTLeft_MBcorr;
c3_MBcorr = MBCorrected .* BGTRight_MBcorr;

c1_hyb = hybCorrected .* cortex_hyb;
c2_hyb = hybCorrected .* BGTLeft_hyb;
c3_hyb = hybCorrected .* BGTRight_hyb;

c1_sens = sensCorrected .* cortex_sens;
c2_sens = sensCorrected .* BGTLeft_sens;
c3_sens = sensCorrected .* BGTRight_sens;

c1_ori = img_ori .* cortex_ori;
c2_ori = img_ori .* BGTLeft_ori;
c3_ori = img_ori .* BGTRight_ori;

c1_vol = img_vol .* cortex_vol;
c2_vol = img_vol .* BGTLeft_vol;
c3_vol = img_vol .* BGTRight_vol;

clear cortex_vol cortex_ori cortex_MBcorr cortex_hyb cortex_sens
clear BGTLeft_vol BGTLeft_ori BGTLeft_MBcorr BGTLeft_hyb BGTLeft_sens
clear BGTRight_vol BGTRight_ori BGTRight_MBcorr BGTRight_hyb BGTRight_sens


%% Calculations

c1_vol(c1_vol==0) = NaN; c2_vol(c2_vol==0) = NaN; c3_vol(c3_vol==0) = NaN; 
c1_ori(c1_ori==0) = NaN; c2_ori(c2_ori==0) = NaN; c3_ori(c3_ori==0) = NaN; 
c1_MBcorr(c1_MBcorr==0) = NaN; c2_MBcorr(c2_MBcorr==0) = NaN; c3_MBcorr(c3_MBcorr==0) = NaN; 
c1_sens(c1_sens==0) = NaN; c2_sens(c2_sens==0) = NaN; c3_sens(c3_sens==0) = NaN; 
c1_hyb(c1_hyb==0) = NaN; c2_hyb(c2_hyb==0) = NaN; c3_hyb(c3_hyb==0) = NaN; 
 
% Smax, Smin
Smax_c1_vol = max(c1_vol(:)); Smin_c1_vol = min(c1_vol(:));
Smax_c2_vol = max(c2_vol(:)); Smin_c2_vol = min(c2_vol(:));
Smax_c3_vol = max(c3_vol(:)); Smin_c3_vol = min(c3_vol(:));

Smax_c1_ori = max(c1_ori(:)); Smin_c1_ori = min(c1_ori(:));
Smax_c2_ori = max(c2_ori(:)); Smin_c2_ori = min(c2_ori(:));
Smax_c3_ori = max(c3_ori(:)); Smin_c3_ori = min(c3_ori(:));

Smax_c1_MBcorr = max(c1_MBcorr(:)); Smin_c1_MBcorr = min(c1_MBcorr(:));
Smax_c2_MBcorr = max(c2_MBcorr(:)); Smin_c2_MBcorr = min(c2_MBcorr(:));
Smax_c3_MBcorr = max(c3_MBcorr(:)); Smin_c3_MBcorr = min(c3_MBcorr(:));

Smax_c1_sens = max(c1_sens(:)); Smin_c1_sens = min(c1_sens(:));
Smax_c2_sens = max(c2_sens(:)); Smin_c2_sens = min(c2_sens(:));
Smax_c3_sens = max(c3_sens(:)); Smin_c3_sens = min(c3_sens(:));

Smax_c1_hyb = max(c1_hyb(:)); Smin_c1_hyb = min(c1_hyb(:));
Smax_c2_hyb = max(c2_hyb(:)); Smin_c2_hyb = min(c2_hyb(:));
Smax_c3_hyb = max(c3_hyb(:)); Smin_c3_hyb = min(c3_hyb(:));

clear c1_vol c2_vol c3_vol 
clear c1_ori c2_ori c3_ori 
clear c1_MBcorr c2_MBcorr c3_MBcorr 
clear c1_sens c2_sens c3_sens 
clear c1_hyb c2_hyb c3_hyb 
clear img_ori img_vol hybCorrected sensCorrected MBCorrected


%% Integral non-uniformity or percent image uniformity (PIU)

PIU_vol = zeros(3,1);
PIU_ori = zeros(3,1);
PIU_MBcorr = zeros(3,1);
PIU_sens = zeros(3,1);
PIU_hyb = zeros(3,1);

delta_c1_vol = Smax_c1_vol - Smin_c1_vol; mid_c1_vol = Smax_c1_vol + Smin_c1_vol;
delta_c2_vol = Smax_c2_vol - Smin_c2_vol; mid_c2_vol = Smax_c2_vol + Smin_c2_vol;
delta_c3_vol = Smax_c3_vol - Smin_c3_vol; mid_c3_vol = Smax_c3_vol + Smin_c3_vol;

PIU_vol(1,:) = (1- delta_c1_vol/mid_c1_vol) * 100;
PIU_vol(2,:) = (1- delta_c2_vol/mid_c2_vol) * 100;
PIU_vol(3,:) = (1- delta_c3_vol/mid_c3_vol) * 100;
clear delta_c1_vol delta_c2_vol delta_c3_vol 
clear mid_c1_vol mid_c2_vol mid_c3_vol 
clear Smax_c1_vol Smax_c2_vol Smax_c3_vol 
clear Smin_c1_vol Smin_c2_vol Smin_c3_vol 

delta_c1_ori = Smax_c1_ori - Smin_c1_ori; mid_c1_ori = Smax_c1_ori + Smin_c1_ori;
delta_c2_ori = Smax_c2_ori - Smin_c2_ori; mid_c2_ori = Smax_c2_ori + Smin_c2_ori;
delta_c3_ori = Smax_c3_ori - Smin_c3_ori; mid_c3_ori = Smax_c3_ori + Smin_c3_ori;

PIU_ori(1,:) = (1- delta_c1_ori/mid_c1_ori) * 100;
PIU_ori(2,:) = (1- delta_c2_ori/mid_c2_ori) * 100;
PIU_ori(3,:) = (1- delta_c3_ori/mid_c3_ori) * 100;
clear delta_c1_ori delta_c2_ori delta_c3_ori 
clear mid_c1_ori mid_c2_ori mid_c3_ori 
clear Smax_c1_ori Smax_c2_ori Smax_c3_ori 
clear Smin_c1_ori Smin_c2_ori Smin_c3_ori 

delta_c1_MBcorr = Smax_c1_MBcorr - Smin_c1_MBcorr; mid_c1_MBcorr = Smax_c1_MBcorr + Smin_c1_MBcorr;
delta_c2_MBcorr = Smax_c2_MBcorr - Smin_c2_MBcorr; mid_c2_MBcorr = Smax_c2_MBcorr + Smin_c2_MBcorr;
delta_c3_MBcorr = Smax_c3_MBcorr - Smin_c3_MBcorr; mid_c3_MBcorr = Smax_c3_MBcorr + Smin_c3_MBcorr;

PIU_MBcorr(1,:) = (1- delta_c1_MBcorr/mid_c1_MBcorr) * 100;
PIU_MBcorr(2,:) = (1- delta_c2_MBcorr/mid_c2_MBcorr) * 100;
PIU_MBcorr(3,:) = (1- delta_c3_MBcorr/mid_c3_MBcorr) * 100;
clear delta_c1_MBcorr delta_c2_MBcorr delta_c3_MBcorr 
clear mid_c1_MBcorr mid_c2_MBcorr mid_c3_MBcorr 
clear Smax_c1_MBcorr Smax_c2_MBcorr Smax_c3_MBcorr 
clear Smin_c1_MBcorr Smin_c2_MBcorr Smin_c3_MBcorr 

delta_c1_sens = Smax_c1_sens - Smin_c1_sens; mid_c1_sens = Smax_c1_sens + Smin_c1_sens;
delta_c2_sens = Smax_c2_sens - Smin_c2_sens; mid_c2_sens = Smax_c2_sens + Smin_c2_sens;
delta_c3_sens = Smax_c3_sens - Smin_c3_sens; mid_c3_sens = Smax_c3_sens + Smin_c3_sens;

PIU_sens(1,:) = (1- delta_c1_sens/mid_c1_sens) * 100;
PIU_sens(2,:) = (1- delta_c2_sens/mid_c2_sens) * 100;
PIU_sens(3,:) = (1- delta_c3_sens/mid_c3_sens) * 100;
clear delta_c1_sens delta_c2_sens delta_c3_sens 
clear mid_c1_sens mid_c2_sens mid_c3_sens 
clear Smax_c1_sens Smax_c2_sens Smax_c3_sens
clear Smin_c1_sens Smin_c2_sens Smin_c3_sens 

delta_c1_hyb = Smax_c1_hyb - Smin_c1_hyb; mid_c1_hyb = Smax_c1_hyb + Smin_c1_hyb;
delta_c2_hyb = Smax_c2_hyb - Smin_c2_hyb; mid_c2_hyb = Smax_c2_hyb + Smin_c2_hyb;
delta_c3_hyb = Smax_c3_hyb - Smin_c3_hyb; mid_c3_hyb = Smax_c3_hyb + Smin_c3_hyb;

PIU_hyb(1,:) = (1- delta_c1_hyb/mid_c1_hyb) * 100;
PIU_hyb(2,:) = (1- delta_c2_hyb/mid_c2_hyb) * 100;
PIU_hyb(3,:) = (1- delta_c3_hyb/mid_c3_hyb) * 100;
clear delta_c1_hyb delta_c2_hyb delta_c3_hyb 
clear mid_c1_hyb mid_c2_hyb mid_c3_hyb 
clear Smax_c1_hyb Smax_c2_hyb Smax_c3_hyb 
clear Smin_c1_hyb Smin_c2_hyb Smin_c3_hyb 

PIU_all = cat(2,PIU_vol,PIU_ori,PIU_MBcorr,PIU_sens,PIU_hyb);
clear PIU_vol PIU_ori PIU_MBcorr PIU_hyb PIU_sens

save(fullfile(pathOUT,'PIU_values_exVivo.mat'), 'PIU_all');


%% Important stuff for plot

cmap = [0 0 170; 255 128 0; 255 0 127; 0 153 76; 255 255 0; 102 0 102; 146 226 55; 51 51 255; 153 0 0; 64 64 64; 0 102 0; 0 153 153];
cmap = cmap ./ 256;


%% Plot

roi_labels = {'Cortex'; 'BGT (left)'; 'BGT (right)'};

hF = figure(); 
plot(PIU_all(:,4),1:3, 'LineWidth', 3, 'MarkerSize',25,'Marker','.', 'Color',cmap(1,:)), axis ij,hold on, %easy
plot(PIU_all(:,3),1:3, 'LineWidth', 3, 'MarkerSize',25,'Marker','.', 'Color',cmap(6,:)),axis ij,           %MB  
plot(PIU_all(:,5),1:3, 'LineWidth', 3, 'MarkerSize',25,'Marker','.', 'Color',cmap(8,:)),axis ij,          %hybrid
plot(PIU_all(:,2),1:3, 'LineWidth', 3, 'MarkerSize',25,'Marker','.', 'Color',cmap(9,:)),axis ij,          %ori
plot(PIU_all(:,1),1:3, 'LineWidth', 3, 'MarkerSize',25,'Marker','.', 'Color',cmap(4,:)),axis ij, hold off %vol

xlim([0 105])
ax = gca; 
ax.YAxis.TickValues = 1:1:3;
ax.YAxis.TickLabel = roi_labels;
ax.XAxis.TickValues = [0,35,70,100];
set(gca, 'FontSize', 14)
grid on; 
set(gcf,'units','normalized','outerposition',[0 0 0.25 1]);
saveas(hF, fullfile(pathOUT, 'PIU_plot_exVivo.png'));


